# startupstack-tenant-service

The tenant service is deprecated in favor of the identity service. The repo will stick around.

This is the tenant service, which makes up a part of Startup-stack. It handles users, tenants and tokens. It also has its own database (handled by Hibernate), most notibly to store information regarding tenants as well as storing refresh tokens as users are logged in. Using the refresh token, an expired token generated by a backend IDP can be exchanged for a fresh one. The tenant service does not store credentials by itself nor does it generate OAuth2 tokens by itself. It relies on a third party IDP to do this. At this time it's Google's Firebase that is implemented, but the REST resources are decoupled from the implementation, so other IDPs can be implemented as well.

The itention is for all Startup-stack services to connect to the tenant service to validate tokens, and if expired, request a new one. Other services will not know about the refresh token and only the tenant service controls this. When a user logs out, the refresh token is removed from the DB, and the only way then to proceed is for a user to log in with their credentials.

The Firebase implementation uses both the Firebase Admin SDK as well as the REST API. The reason for this is that the Admin SDK has no login capabilities (Firebase expects you use the client SDK for that, however that is mostly aimed for Javascript front-ends). So it uses the REST API instead. This split may change in the future so that only the REST interface is used.

As with all backend services, this is written with Quarkus, a Java framework aimed at microservices. It leverages the standard Quarkus profiles so you will see them back in the configuration parameters below.

For more information regarding Startup-stack, check out the parent Github page on https://github.com/Transpose-IT/startup-stack

# Configuration properties

The `application.properties` expects a couple of parameters to be set:

|parameter|example|description|
| --- | --- | --- |
|`%(dev\|test\|prod).startupstack.tenantservice.firebase.keyfile`|`/home/user/firebase-adminsdk.json`|This holds the path to the service account json file created in the Firebase admin console. If you use multiple projects, you need to specify which json file belongs to which Quarkus profile, otherwise you can leave the profile portion off|
|`%(dev\|test\|prod).startupstack.tenantservice.firebase.webapikey`|`APIKEY123-firebase`|The webapi key for the Firebase REST endpoint, also uses Quarkus profiles like the SDK keyfile|
|`quarkus.datasource.url`|`jdbc:postgresql://localhost:5432/tenant_service`|
|`quarkus.datasource.driver`|`org.postgresql.Driver`| |
|`quarkus.datasource.username`|`username`| |
|`quarkus.datasource.password`|`very-insecure`| |
|`%(dev\|test\|prod).quarkus.hibernate-orm.database.generation`| `drop-and-create` or `none`| Specifies if Hibernate should drop and recreate the database on startup. Obviously set this to `none` on production.| 
|`%(dev\|test\|prod)test.quarkus.hibernate-orm.sql-load-script`| `import-dev.sql`| A name of a file in the `resources` directory that is ran to pre-populate the database on startup|
